<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Identify damaged cells — identify_damaged_cells • DropletQC</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Identify damaged cells — identify_damaged_cells" />
<meta property="og:description" content="This function uses a combination of the cell UMI counts and the
nuclear fraction score to assign each cell one of two values; &quot;cell&quot; or
&quot;damaged_cell&quot;. This is based on the idea that damaged cells have a lower
UMI count and higher nuclear fraction than whole cells. The expected input
is a data frame with four columns. The first three columns should contain;
the nuclear fraction score, total UMIs and a character vector describing
each cell as &quot;cell&quot; or &quot;empty_droplet&quot;. This is the format output by the
identify_empty_drops function. The fourth column should be a character
vector with user-assigned cell types. Internally, the provided data frame
is split by cell type and a Gaussian mixture model with a maximum of two
components is fit to the umi counts and nuclear fraction scores. The
parameters of the model are estimated using expectation maximisation (EM)
with the mclust package. The best model is selected using the Bayesian
Information Criterion (BIC). The two populations (cells and damaged cells)
are assumed to have equal variance (mclust model name &quot;EEI&quot;)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DropletQC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/DropletQC.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Identify damaged cells</h1>
    
    <div class="hidden name"><code>identify_damaged_cells.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function uses a combination of the cell UMI counts and the
nuclear fraction score to assign each cell one of two values; "cell" or
"damaged_cell". This is based on the idea that damaged cells have a lower
UMI count and higher nuclear fraction than whole cells. The expected input
is a data frame with four columns. The first three columns should contain;
the nuclear fraction score, total UMIs and a character vector describing
each cell as "cell" or "empty_droplet". This is the format output by the
<code>identify_empty_drops</code> function. The fourth column should be a character
vector with user-assigned cell types. Internally, the provided data frame
is split by cell type and a Gaussian mixture model with a maximum of two
components is fit to the umi counts and nuclear fraction scores. The
parameters of the model are estimated using expectation maximisation (EM)
with the <code>mclust</code> package. The best model is selected using the Bayesian
Information Criterion (BIC). The two populations (cells and damaged cells)
are assumed to have equal variance (mclust model name "EEI").</p>
    </div>

    <pre class="usage"><span class='fu'>identify_damaged_cells</span><span class='op'>(</span>
  <span class='va'>nf_umi_ed_ct</span>,
  nf_sep <span class='op'>=</span> <span class='fl'>0.15</span>,
  umi_sep_perc <span class='op'>=</span> <span class='fl'>50</span>,
  output_plots <span class='op'>=</span> <span class='cn'>FALSE</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>nf_umi_ed_ct</th>
      <td><p>data frame, with four columns. The first three columns
should match the output from the <code>identify_empty_drops</code> function. The
fourth column should contain cell type names.</p></td>
    </tr>
    <tr>
      <th>nf_sep</th>
      <td><p>numeric, the minimum separation of the nuclear fraction score
required between the cell and damage cell populations</p></td>
    </tr>
    <tr>
      <th>umi_sep_perc</th>
      <td><p>numeric, this is the minimum percentage of UMIs which the
damaged cell population is required to have compared to the cell
population. For example, if the mean UMI of the distribution fit to the
whole cell population is 10,000 UMIs, the mean of the distribution fit to
the damaged cell population must be at less than 7,000 UMIs if the umi_sep
parameter is 30 (%)</p></td>
    </tr>
    <tr>
      <th>output_plots</th>
      <td><p>logical, whether or not to return plots</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>logical, whether to print updates and progress while fitting
with EM</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>list, of length two. The first element in the list contains a data
frame with the same dimensions input to the <code>nf_umi_ed_ct</code> argument, with
"damaged_cell" now recorded in the third column. The second element is NULL
unless <code>output_plots</code>=TRUE. If requested, three plots are returned for each
cell type in a named list, combined using <code><a href='https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html'>ggpubr::ggarrange</a></code>. For each
cell type, the first plot illustrates the cell and damaged cell populations
(if any) in a plot of nuclear fraction vs log10(UMI counts). Damaged cells
are expected to be in the lower right portion of the plot(lower UMI counts
and higher nuclear fraction). The second and third plots show the model
fits to the nuclear fraction and UMI count distributions respectively.
Solid lines indicate the distribution mean, while dashed lines indicate the
positions of the thrsholds controlled by the <code>nf_sep</code> and <code>umi_sep</code>
parameters.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>#1</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"qc_examples"</span><span class='op'>)</span>
<span class='va'>gbm</span> <span class='op'>&lt;-</span> <span class='va'>qc_examples</span><span class='op'>[</span><span class='va'>qc_examples</span><span class='op'>$</span><span class='va'>sample</span><span class='op'>==</span><span class='st'>"MB"</span>,<span class='op'>]</span>
<span class='va'>gbm.ed</span> <span class='op'>&lt;-</span> <span class='va'>gbm</span><span class='op'>[</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"nuclear_fraction_droplet_qc"</span>,<span class='st'>"umi_count"</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>gbm.ed</span> <span class='op'>&lt;-</span> <span class='fu'><a href='identify_empty_drops.html'>identify_empty_drops</a></span><span class='op'>(</span>nf_umi <span class='op'>=</span> <span class='va'>gbm.ed</span><span class='op'>)</span>
<span class='va'>gbm.ed</span><span class='op'>$</span><span class='va'>cell_type</span> <span class='op'>&lt;-</span> <span class='va'>gbm</span><span class='op'>$</span><span class='va'>cell_type</span>
<span class='va'>gbm.ed.dc</span> <span class='op'>&lt;-</span> <span class='fu'>identify_damaged_cells</span><span class='op'>(</span><span class='va'>gbm.ed</span>, verbose<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span>
<span class='va'>gbm.ed.dc</span> <span class='op'>&lt;-</span> <span class='va'>gbm.ed.dc</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>gbm.ed.dc</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                    nuclear_fraction_droplet_qc umi_count cell_status
#&gt; AAACCCACAAGAATAC-1                   0.4176170     12557        cell
#&gt; AAACCCACAATAAGGT-1                   0.3744720     10958        cell
#&gt; AAACCCACAGCCCACA-1                   0.6492798      6095        cell
#&gt; AAACCCACAGTAACGG-1                   0.3900973     12802        cell
#&gt; AAACCCACATAAGATG-1                   0.1312698     13672        cell
#&gt; AAACCCACATAATCGC-1                   0.4443030     26653        cell
#&gt;                                cell_type
#&gt; AAACCCACAAGAATAC-1   neuron_unresolved_2
#&gt; AAACCCACAATAAGGT-1 migrating_interneuron
#&gt; AAACCCACAGCCCACA-1    neuron_hippocampus
#&gt; AAACCCACAGTAACGG-1 migrating_interneuron
#&gt; AAACCCACATAAGATG-1   neuron_unresolved_1
#&gt; AAACCCACATAATCGC-1 migrating_interneuron</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>gbm.ed.dc</span><span class='op'>$</span><span class='va'>cell_status</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt;          cell  damaged_cell empty_droplet 
#&gt;          7389          1349           920 </div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Walter Muskovic.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


